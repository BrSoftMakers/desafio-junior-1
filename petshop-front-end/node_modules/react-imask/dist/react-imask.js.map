{"version":3,"file":"react-imask.js","sources":["../src/mixin.ts","../src/input.ts","../src/hook.ts"],"sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport IMask, { type InputMask, type InputMaskElement, type FactoryOpts, type AllFactoryStaticOpts } from 'imask';\n\n\nexport\ntype Falsy = false | 0 | \"\" | null | undefined;\n\nexport\ntype ReactMaskOpts<Opts extends FactoryOpts=FactoryOpts> = Opts & { unmask?: 'typed' | boolean };\n\nexport\ntype UnmaskValue<Opts extends ReactMaskOpts> =\n  Opts['unmask'] extends 'typed' ? InputMask<Opts>['typedValue'] :\n  Opts['unmask'] extends Falsy ? InputMask<Opts>['value'] :\n  InputMask<Opts>['unmaskedValue']\n;\n\nexport\ntype ReactMaskProps<\n  MaskElement extends InputMaskElement,\n  Opts extends ReactMaskOpts=ReactMaskOpts,\n> = {\n  onAccept?: (value: UnmaskValue<Opts>, maskRef: InputMask<Opts>, e?: InputEvent) => void;\n  onComplete?: (value: UnmaskValue<Opts>, maskRef: InputMask<Opts>, e?: InputEvent) => void;\n  unmask?: Opts['unmask'];\n  value?: UnmaskValue<Opts>;\n  inputRef?: React.Ref<MaskElement>;\n  ref?: React.Ref<React.ComponentType<IMaskInputProps<MaskElement>>>;\n}\n\nconst MASK_PROPS: { [key in keyof (AllFactoryStaticOpts & ReactMaskProps<InputMaskElement, AllFactoryStaticOpts>)]: any } = {\n  // common\n  mask: PropTypes.oneOfType([\n    PropTypes.array,\n    PropTypes.func,\n    PropTypes.string,\n    PropTypes.instanceOf(RegExp),\n    PropTypes.oneOf([Date, Number, IMask.Masked]),\n    PropTypes.instanceOf(IMask.Masked as any),\n  ]),\n  value: PropTypes.any,\n  unmask: PropTypes.oneOfType([\n    PropTypes.bool,\n    PropTypes.oneOf(['typed']),\n  ]),\n  prepare: PropTypes.func,\n  prepareChar: PropTypes.func,\n  validate: PropTypes.func,\n  commit: PropTypes.func,\n  overwrite: PropTypes.oneOfType([\n    PropTypes.bool,\n    PropTypes.oneOf(['shift']),\n  ]),\n  eager: PropTypes.oneOfType([\n    PropTypes.bool,\n    PropTypes.oneOf(['append', 'remove']),\n  ]),\n  skipInvalid: PropTypes.bool,\n\n  // events\n  onAccept: PropTypes.func,\n  onComplete: PropTypes.func,\n\n  // pattern\n  placeholderChar: PropTypes.string,\n  displayChar: PropTypes.string,\n  lazy: PropTypes.bool,\n  definitions: PropTypes.object,\n  blocks: PropTypes.object,\n\n  // enum\n  enum: PropTypes.arrayOf(PropTypes.string),\n\n  // range\n  maxLength: PropTypes.number,\n  from: PropTypes.number,\n  to: PropTypes.number,\n\n  // date\n  pattern: PropTypes.string,\n  format: PropTypes.func,\n  parse: PropTypes.func,\n  autofix: PropTypes.oneOfType([\n    PropTypes.bool,\n    PropTypes.oneOf(['pad']),\n  ]),\n\n  // number\n  radix: PropTypes.string,\n  thousandsSeparator: PropTypes.string,\n  mapToRadix: PropTypes.arrayOf(PropTypes.string),\n  scale: PropTypes.number,\n  normalizeZeros: PropTypes.bool,\n  padFractionalZeros: PropTypes.bool,\n  min: PropTypes.oneOfType([\n    PropTypes.number,\n    PropTypes.instanceOf(Date),\n  ]),\n  max: PropTypes.oneOfType([\n    PropTypes.number,\n    PropTypes.instanceOf(Date),\n  ]),\n\n  // dynamic\n  dispatch: PropTypes.func,\n\n  // ref\n  inputRef: PropTypes.oneOfType([\n    PropTypes.func,\n    PropTypes.shape({ current: PropTypes.object }),\n  ]),\n} as const;\n\nconst MASK_PROPS_NAMES = (Object.keys(MASK_PROPS) as Array<keyof typeof MASK_PROPS>).filter(p => p !== 'value');\nconst NON_MASK_OPTIONS_PROPS_NAMES = ['value', 'unmask', 'onAccept', 'onComplete', 'inputRef'] as const;\n\nexport\ntype ReactElementProps<MaskElement extends InputMaskElement> = Omit<Omit<React.HTMLProps<MaskElement>, keyof typeof MASK_PROPS>, typeof NON_MASK_OPTIONS_PROPS_NAMES[number]>;\ntype NonMaskProps<\n  MaskElement extends InputMaskElement,\n  Props extends IMaskMixinProps<MaskElement>=IMaskMixinProps<MaskElement>\n> = Omit<Props, keyof FactoryOpts>;\n\nexport\ntype ReactMixinComponent<\n  MaskElement extends InputMaskElement,\n> = React.ComponentType<ReactElementProps<MaskElement> & { inputRef: React.Ref<MaskElement>; }>;\n\nexport\ntype MaskPropsKeys = Exclude<keyof typeof MASK_PROPS, typeof NON_MASK_OPTIONS_PROPS_NAMES[number]>;\nconst MASK_OPTIONS_PROPS_NAMES = MASK_PROPS_NAMES.filter(pName =>\n  NON_MASK_OPTIONS_PROPS_NAMES.indexOf(pName as typeof NON_MASK_OPTIONS_PROPS_NAMES[number]) < 0\n) as Array<MaskPropsKeys>;\n\nexport\ntype MaskOpts<\n  MaskElement extends InputMaskElement,\n  Props extends IMaskInputProps<MaskElement>=IMaskInputProps<MaskElement>\n> = Extract<Props, FactoryOpts>;\n\nexport\ntype IMaskMixinProps<\n  MaskElement extends InputMaskElement,\n  Props extends (ReactMaskOpts & ReactMaskProps<MaskElement>)=ReactMaskOpts & ReactMaskProps<MaskElement>,\n> = Omit<ReactMaskProps<MaskElement, Props>, 'ref'> & MaskOpts<MaskElement, Props>;\n\nexport\ntype IMaskInputProps<\n  MaskElement extends InputMaskElement,\n  Props extends IMaskMixinProps<MaskElement>=IMaskMixinProps<MaskElement>,\n> = ReactElementProps<MaskElement> & IMaskMixinProps<MaskElement, Props>;\n\n\nexport default\nfunction IMaskMixin<\n  MaskElement extends InputMaskElement,\n  Props extends IMaskInputProps<MaskElement>,\n>(ComposedComponent: ReactMixinComponent<MaskElement>) {\n  const MaskedComponent = class extends React.Component<Props> {\n    static displayName: string;\n    static propTypes: typeof MASK_PROPS;\n\n    declare element: MaskElement;\n    declare maskRef?: InputMask<MaskOpts<MaskElement, Props>>;\n\n    constructor (props: Props) {\n      super(props);\n      this._inputRef = this._inputRef.bind(this);\n    }\n\n    componentDidMount () {\n      if (!this.props.mask) return;\n\n      this.initMask();\n    }\n\n    componentDidUpdate () {\n      const props = this.props;\n      const maskOptions = this._extractMaskOptionsFromProps(props);\n      if (maskOptions.mask) {\n        if (this.maskRef) {\n          this.maskRef.updateOptions(maskOptions as any); // TODO fix\n          if ('value' in props && props.value !== undefined) this.maskValue = props.value;\n        } else {\n          this.initMask(maskOptions);\n        }\n      } else {\n        this.destroyMask();\n        if ('value' in props && props.value !== undefined) {\n          if ((this.element as HTMLElement)?.isContentEditable && (this.element as HTMLElement).tagName !== 'INPUT' && (this.element as HTMLElement).tagName !== 'TEXTAREA') (this.element as HTMLElement).textContent = props.value;\n          else (this.element as HTMLInputElement).value = props.value;\n        }\n      }\n    }\n\n    componentWillUnmount () {\n      this.destroyMask();\n    }\n\n    _inputRef (el: MaskElement) {\n      this.element = el;\n      if (this.props.inputRef) {\n        if (Object.prototype.hasOwnProperty.call(this.props.inputRef, 'current'))\n          (this.props.inputRef as React.MutableRefObject<MaskElement>).current = el;\n        else\n          (this.props.inputRef as React.RefCallback<MaskElement>)(el);\n      }\n    }\n\n    initMask (maskOptions: MaskOpts<MaskElement, Props> = this._extractMaskOptionsFromProps(this.props)) {\n      this.maskRef = IMask(this.element, maskOptions)\n        .on('accept', this._onAccept.bind(this))\n        .on('complete', this._onComplete.bind(this));\n\n      if ('value' in this.props && this.props.value !== undefined) this.maskValue = this.props.value;\n    }\n\n    destroyMask () {\n      if (this.maskRef) {\n        this.maskRef.destroy();\n        delete this.maskRef;\n      }\n    }\n\n    _extractMaskOptionsFromProps (props: Readonly<Props>): MaskOpts<MaskElement, Props> {\n      const { ...cloneProps }: Readonly<Props> = props;\n\n      // keep only mask options\n      (Object.keys(cloneProps) as Array<keyof Props>)\n        .filter(prop => MASK_OPTIONS_PROPS_NAMES.indexOf(prop as MaskPropsKeys) < 0)\n        .forEach(nonMaskProp => {\n          delete cloneProps[nonMaskProp];\n        });\n\n      return cloneProps as MaskOpts<MaskElement, Props>;\n    }\n\n    _extractNonMaskProps (props: Readonly<Props>): NonMaskProps<MaskElement, Props> {\n      const { ...cloneProps } = props as Props;\n\n      (MASK_PROPS_NAMES as Array<keyof Props>).forEach(maskProp => {\n        delete cloneProps[maskProp];\n      });\n      if (!('defaultValue' in cloneProps)) cloneProps.defaultValue = props.mask ? '' : cloneProps.value;\n      delete cloneProps.value;\n\n      return cloneProps as NonMaskProps<MaskElement, Props>;\n    }\n\n    get maskValue (): UnmaskValue<Props> {\n      if (!this.maskRef) return '' as UnmaskValue<Props>;\n\n      if (this.props.unmask === 'typed') return this.maskRef.typedValue;\n      if (this.props.unmask) return this.maskRef.unmaskedValue;\n      return this.maskRef.value;\n    }\n\n    set maskValue (value: UnmaskValue<Props>) {\n      if (!this.maskRef) return;\n\n      value = (value == null && this.props.unmask !== 'typed' ? '' : value) as UnmaskValue<Props>;\n      if (this.props.unmask === 'typed') this.maskRef.typedValue = value;\n      else if (this.props.unmask) this.maskRef.unmaskedValue = value;\n      else this.maskRef.value = value;\n    }\n\n    _onAccept (e?: InputEvent) {\n      if (this.props.onAccept && this.maskRef) this.props.onAccept(this.maskValue, this.maskRef, e);\n    }\n\n    _onComplete (e?: InputEvent) {\n      if (this.props.onComplete && this.maskRef) this.props.onComplete(this.maskValue, this.maskRef, e);\n    }\n\n    render () {\n      return React.createElement(ComposedComponent, {\n        ...this._extractNonMaskProps(this.props),\n        inputRef: this._inputRef,\n      });\n    }\n  };\n\n  const nestedComponentName = ComposedComponent.displayName || ComposedComponent.name || 'Component';\n  MaskedComponent.displayName = `IMask(${nestedComponentName})`;\n  MaskedComponent.propTypes = MASK_PROPS;\n\n  return React.forwardRef<\n    React.ComponentType<Props>,\n    Props\n  >((props, ref) => React.createElement(MaskedComponent, { ...props, ref }));\n}\n","import React from 'react';\nimport IMaskMixin, { IMaskInputProps } from './mixin';\n\n\nconst IMaskInputClass = IMaskMixin(({ inputRef, ...props }) =>\n  React.createElement('input', {\n    ...props,\n    ref: inputRef,\n  })\n);\n\nconst IMaskInputFn = <\n  Props extends IMaskInputProps<HTMLInputElement>,\n>(\n  props: Props,\n  ref: React.Ref<React.ComponentType<Props>>\n) =>\n  React.createElement(IMaskInputClass as any, { ...props, ref })  // TODO fix no idea\n;\n\nconst IMaskInput = React.forwardRef(IMaskInputFn as <\n  Props extends IMaskInputProps<HTMLInputElement>,\n>(\n  props: Props & { ref?: React.Ref<React.ComponentType<Props>> }\n) => React.ReactElement<Props>);\n\n\nexport default IMaskInput;\n","import IMask, { type InputMask, type InputMaskElement, type FactoryOpts } from 'imask';\nimport { useEffect, useCallback, useState, useRef, Dispatch } from 'react';\nimport type { MutableRefObject } from 'react';\nimport type { ReactMaskProps } from './mixin';\n\n\nexport default\nfunction useIMask<\n  MaskElement extends InputMaskElement,\n  Opts extends FactoryOpts,\n>(\n  opts: Opts,\n  { onAccept, onComplete }: Partial<Pick<ReactMaskProps<MaskElement, Opts>, 'onAccept' | 'onComplete'>> = {}\n): {\n  ref: MutableRefObject<MaskElement | null>,\n  maskRef: MutableRefObject<InputMask<Opts> | null>,\n  value: InputMask<Opts>['value'],\n  setValue: Dispatch<InputMask<Opts>['value']>,\n  unmaskedValue: InputMask<Opts>['unmaskedValue'],\n  setUnmaskedValue: Dispatch<InputMask<Opts>['unmaskedValue']>,\n  typedValue: InputMask<Opts>['typedValue'],\n  setTypedValue: Dispatch<InputMask<Opts>['typedValue']>,\n} {\n  const ref = useRef<MaskElement | null>(null);\n  const maskRef = useRef<InputMask<Opts> | null>(null);\n  const [initialized, setInitialized] = useState<boolean>(false);\n  const [lastAcceptState, setLastAcceptState] = useState<{\n    value?: InputMask<Opts>['value'],\n    unmaskedValue?: InputMask<Opts>['unmaskedValue'],\n    typedValue?: InputMask<Opts>['typedValue'],\n  }>({});\n  const [value, setValue] = useState<InputMask<Opts>['value']>('');\n  const [unmaskedValue, setUnmaskedValue] = useState<InputMask<Opts>['unmaskedValue']>('');\n  const [typedValue, setTypedValue] = useState<InputMask<Opts>['typedValue']>();\n\n  const _destroyMask = useCallback(() => {\n    if (!initialized) return;\n    maskRef.current?.destroy();\n    maskRef.current = null;\n  }, []);\n\n  const _onAccept = useCallback(\n    (event?: InputEvent) => {\n      const m = maskRef.current;\n      if (!m) return;\n\n      setLastAcceptState({\n        value: m.value,\n        unmaskedValue: m.unmaskedValue,\n        typedValue: m.typedValue,\n      });\n      setTypedValue(m.typedValue);\n      setUnmaskedValue(m.unmaskedValue);\n      setValue(m.value);\n      onAccept?.(m.value, m, event);\n    },\n    [onAccept],\n  );\n\n  const _onComplete = useCallback(\n    () => maskRef.current && onComplete?.(maskRef.current.value, maskRef.current),\n    [onComplete],\n  );\n\n  useEffect(() => {\n    const el = ref.current;\n\n    if (!el || !opts?.mask) return _destroyMask();\n\n    const mask = maskRef.current;\n\n    if (!mask) {\n      if (el && opts?.mask) {\n        maskRef.current = IMask(el, opts);\n        _onAccept();\n      }\n    } else {\n      mask?.updateOptions(opts as any); // TODO fix no idea\n    }\n    setInitialized(Boolean(maskRef.current));\n  }, [opts, _destroyMask, _onAccept]);\n\n  useEffect(() => {\n    if (!maskRef.current) return;\n\n    const mask = maskRef.current;\n\n    mask.on('accept', _onAccept);\n    mask.on('complete', _onComplete);\n\n    return () => {\n      mask.off('accept', _onAccept);\n      mask.off('complete', _onComplete);\n    };\n  }, [_onAccept, _onComplete]);\n\n  useEffect(() => {\n    const { value: lastAcceptValue, ...state } = lastAcceptState;\n    const mask = maskRef.current;\n    if (mask && initialized) {\n      if (lastAcceptValue !== value) mask.value = value;\n      setLastAcceptState(state);\n    }\n  }, [value]);\n\n  useEffect(() => {\n    const { unmaskedValue: lastAcceptUnmaskedValue, ...state } = lastAcceptState;\n    const mask = maskRef.current;\n    if (mask && initialized) {\n      if (lastAcceptUnmaskedValue !== unmaskedValue) mask.unmaskedValue = unmaskedValue;\n      setLastAcceptState(state);\n    }\n  }, [unmaskedValue]);\n\n  useEffect(() => {\n    const { typedValue: lastAcceptTypedValue, ...state } = lastAcceptState;\n    const mask = maskRef.current;\n    if (mask && initialized) {\n      if (lastAcceptTypedValue !== typedValue) mask.typedValue = typedValue;\n      setLastAcceptState(state);\n    }\n  }, [typedValue]);\n\n  useEffect(() => _destroyMask, [_destroyMask]);\n\n  return {\n    ref,\n    maskRef,\n    value, setValue,\n    unmaskedValue, setUnmaskedValue,\n    typedValue, setTypedValue,\n  };\n}\n"],"names":["MASK_PROPS","mask","PropTypes","oneOfType","array","func","string","instanceOf","RegExp","oneOf","Date","Number","IMask","Masked","value","any","unmask","bool","prepare","prepareChar","validate","commit","overwrite","eager","skipInvalid","onAccept","onComplete","placeholderChar","displayChar","lazy","definitions","object","blocks","enum","arrayOf","maxLength","number","from","to","pattern","format","parse","autofix","radix","thousandsSeparator","mapToRadix","scale","normalizeZeros","padFractionalZeros","min","max","dispatch","inputRef","shape","current","MASK_PROPS_NAMES","Object","keys","filter","p","NON_MASK_OPTIONS_PROPS_NAMES","MASK_OPTIONS_PROPS_NAMES","pName","indexOf","IMaskMixin","ComposedComponent","_class","MaskedComponent","React","Component","constructor","props","_inputRef","bind","componentDidMount","initMask","componentDidUpdate","maskOptions","_extractMaskOptionsFromProps","maskRef","updateOptions","undefined","maskValue","destroyMask","_this$element","element","isContentEditable","tagName","textContent","componentWillUnmount","el","prototype","hasOwnProperty","call","on","_onAccept","_onComplete","destroy","cloneProps","prop","forEach","nonMaskProp","_extractNonMaskProps","maskProp","defaultValue","typedValue","unmaskedValue","e","render","createElement","displayName","propTypes","nestedComponentName","name","forwardRef","ref","IMaskInputClass","_ref","IMaskInputFn","IMaskInput","useIMask","opts","_temp","useRef","initialized","setInitialized","useState","lastAcceptState","setLastAcceptState","setValue","setUnmaskedValue","setTypedValue","_destroyMask","useCallback","_maskRef$current","event","m","useEffect","Boolean","off","lastAcceptValue","state","lastAcceptUnmaskedValue","lastAcceptTypedValue"],"mappings":"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"}